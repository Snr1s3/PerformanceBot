name: Notify Me

on:
  workflow_run:
    workflows: ["Test and Build", "Deploy mdBook site to Pages"]
    types:
      - completed

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Get commit info
        id: commit
        run: |
          COMMIT_SHA=$(curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
            "${{ github.event.workflow_run.head_commit.url }}" | jq -r '.sha')
          echo "commit_sha=$COMMIT_SHA" >> $GITHUB_OUTPUT
      - name: Send Telegram notification
        run: |
          TITLE="üîî ${{ github.repository }} - Commit: ${{ github.event.workflow_run.head_commit.id }}"
          if [ "${{ github.event.workflow_run.conclusion }}" = "success" ]; then
            STATUS="‚úÖ Workflow '${{ github.event.workflow_run.name }}' succeeded."
          else
            STATUS="‚ùé Workflow '${{ github.event.workflow_run.name }}' failed."
          fi
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="${TITLE}\n${STATUS}"
